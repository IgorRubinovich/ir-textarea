/** 
	media embedder.
	adds embed-aspect-ratio (wrapperClass) wrapper around the tag.

	since the output contains no custom components,
	it's the responsibility of the component user to declare appropriate classes such as follows:
	
	/* css from http://fettblog.eu/blog/2013/06/16/preserving-aspect-ratio-for-embedded-iframes/) */
	.embed-aspect-ratio
	{
		position: relative;
		width: 100%;
		height: 0;
		padding-bottom: 51%;		
	}
	
	.embed-aspect-ratio iframe {
		position: absolute;
		width: 100%;
		height: 100%;
		left: 0; top: 0;	
	}
	
*/

<dom-module id="ir-textarea-mediaembedder">
	<style>
		textarea {
			width : 100%;
			min-height: 100px;
			margin-bottom : 20px;
		}
		
		
	</style>
	<template>
		<paper-dialog on-iron-overlay-opened="focusInput" id="dialog" auto-fit-on-attach>
			<h2>Paste your embed code below</h2>
			<div>
				<div class="layout vertical">
					<textarea rows="7" cols="40" id="input" value="{{ embedCode::keyup }}"></textarea>
					<paper-checkbox checked="{{ noWrapper }}">no wrapper</paper-checkbox>
				</div>
			</div>
			<div class="buttons">
				<paper-button dialog-dismiss>Cancel</paper-button>
				<paper-button dialog-confirm on-tap="accept">OK</paper-button>
			</div>
		</paper-dialog>
	</template>
</dom-module>
<script>
(function () {
	Polymer({
		is : 'ir-textarea-mediaembedder',
		
		properties : {
			editor : { type : Object }
		},
		
		open : function() {	
			this.$.dialog.sizingTarget = this.$.input;
			this.$.dialog.stopResizeNotificationsFor(this.$.dialog)
		
			this.$.dialog.open();
			Polymer.dom.flush();
		},
		
		focusInput : function()  
		{
			this.$.input.focus();
		},
		
		acceptOnEnter : function(e) {
			if((e.which || e.keyCode) == 13)
				this.accept();
		},
	
		accept : function() {
			var value, d, w, h;
			
			value = this.embedCode;
			
			value = HTMLtoXML(value).trim();
			
			d = document.createElement('div');
			
			d.innerHTML = value;
			
			if(!this.noWrapper && value)
			{
				value = '<div class=' + this.wrapperClass + '>' + value + '</div>';
				if(d.firstChild.tagName == 'IFRAME')
				{
					w = d.firstChild.getAttribute('width');
					h = d.firstChild.getAttribute('height');
				}
				d.innerHTML = value;
				if(w && h)
				{
					d.firstChild.style.width = 100 + "%";
					d.firstChild.style.paddingBottom = (h * 100 / w) + "%"
				}
				value = d.innerHTML;
			}
			
			if(this._promptCallback)
				this._promptCallback(value);
				
			this.set('embedCode', '');

			this._promptCallback = null;							

			this.$.dialog.close();
		},
		
		prompt : function(callback) {
			this._promptCallback = callback;
			this.open();
		},		

		behaviors: [
			ir.SelectorBehavior
		],
		
		properties : {
			"wrapperClass" : {
				type : String,
				value : "embed-aspect-ratio"
			}
		}

	});
})();
</script>
