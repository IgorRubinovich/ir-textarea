<!--
@license
Copyright (c) 2015 Igor Rubinovich. All rights reserved.
This code may only be used under the MIT license found at http://opensource.org/licenses/MIT
File browser and uploader.
Works with arrays of (node fs.Stats)[https://nodejs.org/api/fs.html#fs_class_fs_stats] objects.

@demo
-->



<dom-module id="ir-textarea-table">
    <style>
        input{
            display: block;
            margin: 10px 0;
            width: 100px;
        }
    </style>
    <template>
        <paper-dialog on-dom-changed="refitDialog" id="dialog"> <!--  on-iron-overlay-closed="closed" -->

            <paper-dialog-scrollable id="scrollableDialog">
                <div id="tableData">
                    Cells: <input is="iron-input" on-input="createTable2" id="Cells" value="1" >
                    Rows: <input is="iron-input"  on-input="createTable2" id="Rows" value="1" >
                </div>
            </paper-dialog-scrollable>
            <div class="buttons">
                <paper-button raised on-click="promptSelect" disabled={{_tableState}} >Create Table</paper-button>
                <paper-button raised on-click="hideDialog">Cancel</paper-button>
            </div>
        </paper-dialog>

    </template>

    <script>
        (function() {
            Polymer({
                is: 'ir-textarea-table',

                properties: {
                    editor : { type : Object },
                    _tableState:{
                        type: Boolean,
                        value: true
                    }
                },

                populateTable : function (table, rows, cells, content) {
                    if (!table) table = document.createElement('table');

                    for (var i = 0; i < rows; ++i) {
                        var row = document.createElement('tr');
                        for (var j = 0; j < cells; ++j) {
                            row.appendChild(document.createElement('td'));
                            row.cells[j].appendChild(document.createTextNode(content + (j + 1)));
                        }
                        table.appendChild(row);
                    }
                    return table;
                },

                createTable2: function(e){
                    var cells = this.$.Cells.value;
                    var rows = this.$.Rows.value;
                    var table = this.populateTable(null, rows, cells, "Text");
                    table = table.outerHTML;
                    console.log('table created');
                    this.set("_tableState", false);
                    this._updateValue(table);
                },

                _updateValue : function(table) {
                    var that = this;
                    that.value = table;
                },

                hideDialog : function (e) {
                    this.$.dialog.close();
                },

                open : function(ev) {

                    this.$.dialog.open();
                },

                prompt : function(callback) {
                    this.promptCallback = callback;
                    this.open();
                },

                promptSelect : function() {
                    console.log('prompt selected!')
                    this.hideDialog();
                    this.promptCallback(this.value);
                },

                behaviors: [
                    ir.SelectorBehavior
                ]

            });


        })();

    </script>
</dom-module>
